<!DOCTYPE html>
<html>
<!-- TODO 
language via global style
include meals
calculate costs
improve summary with option values instead of keys
-->

<head><meta charset="utf-8"/>
<style type="text/css">
body { background: #ddd; margin: 0; padding: 0; height: 100%; }
div#page { max-width: 1146px; margin: 0em auto; border-left: 1px solid #aaa; border-right: 1px solid #aaa; background: #fff; min-height: 101%; }
div#forms { padding: 1% }
td { border-left: 2px solid #eee; white-space: nowrap }
div.list { border: 2px solid blue; margin: 1ex 0ex; padding: 1ex; margin-bottom: 0px; border-radius: 1ex }
table.add { border: 1px solid blue; background: #f0faff; margin: 1ex; padding: 1ex; margin-top: 0px; padding-top:0px}
div.error { background: #fff; color: #800; font-weight: bold; display: block }
div.id { text-align: center; background: #eee; padding: 1ex; border-radius: 1ex; border: 1px solid black}
span.NL { display: none }
span.EN { display: inline }
</style>
<script type="text/javascript">
"use strict"

var DATA = {}

var FORMS = {
  rider: {
    firstName: { name: { NL: "voornaam", EN: "first name" }, type: "text", check: checkName },
    lastName: { name: { NL: "achternaam", EN: "last name" }, type: "text", check: checkName },
    gender: { name: { NL: "geslacht", EN: "gender" }, type: "radio", check: checkRadio, options: genderOptions },
    birthDate: { name: { NL: "geboortedatum", EN: "date of birth" }, type: "date", check: checkBirth },
    email: { name: { NL: "email adres", EN: "email address" }, type: "text", check: checkEmail, default: '' },
  },
  bike: {
    name: { name: { NL: "Koosnaam", EN: "Given name" }, type: "text", check: checkName, default: '--' },
    standard: { name: { NL: "Fiets", EN: "Bike" }, type: "select", check: null, options: standardOptions },
    make: { name: { NL: "&nbsp;&nbsp;Merk en type", EN: "&nbsp;&nbsp;Make and type" }, type: "text", check: checkName, default: '', preset: makePreset },
    track: { name: { NL: "&nbsp;&nbsp;Aantal wielen", EN: "&nbsp;&nbsp;Number of wheels" }, type: "radio", check: checkRadio, options: trackOptions, preset: trackPreset },
    fairing: { name: { NL: "&nbsp;&nbsp;Stroomlijn", EN: "&nbsp;&nbsp;Fairing" }, type: "radio", check: checkRadio, options: fairingOptions, preset: fairingPreset },
    drive: { name: { NL: "&nbsp;&nbsp;Aandrijving", EN: "&nbsp;&nbsp;Drive" }, type: "select", check: checkSelect, options: driveOptions, preset: drivePreset }
  },
  onehour: {
    _day: 1,
    rider: { name: { NL: "rijder", EN: "rider" }, type: "select", check: checkSelect, options: riderOptions },
    bike: { name: { NL: "fiets", EN: "bike" }, type: "select", check: checkSelect, options: bikeOptions },
  },
  indoor1lap: {
    _day: 1,
    rider: { name: { NL: "rijder", EN: "rider" }, type: "select", check: checkSelect, options: riderOptions },
    bike: { name: { NL: "fiets", EN: "bike" }, type: "select", check: checkSelect, options: bikeOptions },
  },
  singletrack: {
    _day: 1,
    rider: { name: { NL: "rijder", EN: "rider" }, type: "select", check: checkSelect, options: riderOptions },
    bike: { name: { NL: "fiets", EN: "bike" }, type: "select", check: checkSelect, options: bikeOptions },
  },
  multitrack: {
    _day: 1,
    rider: { name: { NL: "rijder", EN: "rider" }, type: "select", check: checkSelect, options: riderOptions },
    bike: { name: { NL: "fiets", EN: "bike" }, type: "select", check: checkSelect, options: bikeOptions },
  },
  outdoor1lap: {
    _day: 2,
    rider: { name: { NL: "rijder", EN: "rider" }, type: "select", check: checkSelect, options: riderOptions },
    bike: { name: { NL: "fiets", EN: "bike" }, type: "select", check: checkSelect, options: bikeOptions },
  },
  threehour: {
    _day: 2,
    rider: { name: { NL: "Rijder", EN: "Rider" }, type: "select", check: checkSelect, options: riderOptions },
    bike: { name: { NL: "Fiets", EN: "Bike" }, type: "select", check: checkSelect, options: bikeOptions },
    duration: { name: { NL: "duur", EN: "duration" }, type: "radio", check: checkSelect, options: durationOptions }
  },
  camping: {
    _simple_: true,
    adultFri: { name: { NL: "Volwassenen vrijdag/zaterdag", EN: "Adults Friday/Saturday" }, price: "&euro; 4", type: "select", options: countOptions },
    childFri: { name: { NL: "Kinderen &lt;16 vrijdag/zaterdag", EN: "Children &lt;16 Friday/Saturday" }, price: "&euro; 2", type: "select", options: countOptions },
    adultSat: { name: { NL: "Volwassenen zaterdag/zondag", EN: "Adults Saturday/Sunday" }, price: "&euro; 4", type: "select", options: countOptions },
    childSat: { name: { NL: "Kinderen &lt;16 zaterdag/zondag", EN: "Children &lt;16 Saturday/Sunday" }, price: "&euro; 2", type: "select", options: countOptions }
  },
  meal: {
    _simple_: true,
    mealPlan: { name: { NL: "Alle maaltijden pakket", EN: "All meals package" }, price: "&euro; 27.50", type: "select", options: countOptions },
    mealFri: { name: { NL: "Maaltijd vrijdagavond", EN: "Meal Friday evening" }, price: "&euro; 10", type: "select", options: countOptions },
    breakfastSat: { name: { NL: "Ontbijt zaterdagochtend", EN: "Breakfast Saturday morning" }, price: "&euro; 6.50", type: "select", options: countOptions },
    mealSat: { name: { NL: "Maaltijd zaterdagavond", EN: "Meal Saturday evening" }, price: "&euro; 17.50", type: "select", options: countOptions },
    breakfastSun: { name: { NL: "Ontbijt zondagochtend", EN: "Breakfast Sunday morning" }, price: "&euro; 6,50", type: "select", options: countOptions }
  }
}

var LANG = {
  rider: {
    NL: ['rijder','rijders'],
    EN: ['rider','riders']
  },
  bike: {
    NL: ['fiets','fietsen'],
    EN: ['bike','bikes']
  },
  onehour: {
    NL: ['rijder+fiets','rijders+fietsen voor de 1-uurs race'],
    EN: ['rider+bike','riders+bikes for the 1 hour race']
  },
  indoor1lap: {
    NL: ['rijder+fiets','rijders+fietsen voor de snelste ronde in het velodrome'],
    EN: ['rider+bike','riders+bikes for the fastest lap indoor']
  },
  outdoor1lap: {
    NL: ['rijder+fiets','rijders+fietsen voor de snelste ronde op de buitenbaan'],
    EN: ['rider+bike','riders+bikes for the fastest lap outdoor circuit']
  },
  singletrack: {
    NL: ['rijder+fiets','rijders+fietsen voor het tweewieler criterium'],
    EN: ['rider+bike','riders+bikes for the single track race']
  },
  multitrack: {
    NL: ['rijder+fiets','rijders+fietsen voor het multi-track criterium'],
    EN: ['rider+bike','riders+bikes for the multi track race']
  },
  threehour: {
    NL: ['rijder+fiets','rijders+fietsen voor de gecombineerde 3/6 uurs race'],
    EN: ['rider+bike','riders+bikes for the combined 3/6 hour race']
  },
  camping: {
    NL: ['camping','camping'],
    EN: ['camping','camping']
  },
  meal: {
    NL: ['maaltijd','maaltijden'],
    EN: ['meal','meals']
  }
}

var FORM_ERROR = false

function initData() {
  try {
    DATA = JSON.parse(getCookie('DATA'))
  } catch(e) {
    DATA = {}
  }
  for (var k in FORMS) if (!DATA[k]) DATA[k] = {}
  summarize()
}

function initLanguage() {
  try {
    var on = JSON.parse(getCookie('LANG'))
  } catch(e) {
    on = 'EN'
  }
  selectLanguage(on)
}

/* field value validation functions */
function checkName(val,itemKey,id) {
  val = val.trim()
  var name = FORMS[itemKey][id].name.EN
  toggleError(itemKey+'-'+id,val && val.length>=2 ? '' : 'Error: enter a valid '+name+'.')
  return val
}

function checkRadio(val,itemKey,id) {
  toggleError(itemKey+'-'+id,val !== undefined ? '' : 'Error: select a value.')
  return val
}

function checkSelect(val,itemKey,id) {
  toggleError(itemKey+'-'+id,val !== '_' ? '' : '<span class="EN">Error: select a value.</span><span class="NL">Fout: kies een waarde.</span>')
  return val
}

function checkEmail(val,itemKey,id) {
  var re = /^(([^<>()\[\]\.,;:\s@\"]+(\.[^<>()\[\]\.,;:\s@\"]+)*)|(\".+\"))@(([^<>()[\]\.,;:\s@\"]+\.)+[^<>()[\]\.,;:\s@\"]{2,})$/i;
  toggleError(itemKey+'-'+id,re.test(val) ? '' : '<span class="EN">Error: invalid email address.</span><span class="NL">Fout: ongeldig email adres.</span>')
  return val
}
  
function checkBirth(val,itemKey,id) {
  if (val) {
    var date = new Date(val)
    var year = date.getFullYear()
    toggleError(itemKey+'-'+id,year>1900 && year<2016 ? '' : '<span class="EN">Error: invalid year.</span><span class="NL">Fout: ongeldig jaar.</span>')
  } else {
    toggleError(itemKey+'-'+id,val ? '' : '<span class="EN">Error: enter a date.</span><span class="NL">Fout: vul een datum in.</span>')
  }
  return val
}

/* option generation functions */
function genderOptions() {
  return {
    male: {EN:'male',NL:'man'},
    female: {EN:'female',NL:'vrouw'}
  }
}

function standardOptions() {
  return {
    _: {EN:'choose ...',NL:'kies ...'},
    unfaired2: {EN:'Unfaired bike',NL:'Ongestroomlijnde tweewieler'},
    unfaired3: {EN:'Unfaired trike',NL:'Ongestroomlijnde trike'},
    tailfaired2: {EN:'Tailfaired bike',NL:'Tweewieler met staartpunt'},
    tailfaired3: {EN:'Tailfaired trike',NL:'Trike met staartpunt'},
    fullyfaired2: {EN:'Fully faired bicycle',NL:'Volledig gestroomlijnde tweeweler'},
    fullyfaired3: {EN:'Fully faired tricycle',NL:'Volledig gestroomlijnde trike'},
    quest: {EN:'Velomobiel.nl Quest',NL:'Velomobiel.nl Quest'},
    df: {EN:'InterCityBike DF',NL:'InterCityBike DF'},
    rowing: {EN:'Rowing bike',NL:'Roeifiets'},
    thys222: {EN:'Thys 222 rowing bike',NL:'Thys 222 roeifiets'},
    tandem: {EN:'Tandem',NL:'Tandem'},
    handbike: {EN:'Handbike',NL:'Handbike'},
    other: {EN:'Other ...',NL:'Anders ...'}
  }
}

function trackOptions() {
  return {
    single: {EN:'two or less',NL:'twee of minder'},
    multi: {EN:'three or more',NL:'drie of meer'}
  }
}

function fairingOptions() {
  return {
    full: {EN:'fully faired',NL:'gestroomlijnd'},
    front: {EN:'front fairing',NL:'alleen voorkant'},
    rear: {EN:'tail fairing',NL:'staartpunt'},
    none: {EN:'unfaired',NL:'ongestroomlijnd'}
  }
}

function driveOptions() {
  return {
    pedal: {EN:'regular',NL:'normaal'},
    rowing: {EN:'rowing movement',NL:'roeibeweging'},
    hand: {EN:'hand drive',NL:'handaabndrijving'},
    special: {EN:'special',NL:'speciaal'}
  }
}

function riderOptions() {
  var riders = DATA.rider
  var options = {}
  for (var k in riders) {
    var r = riders[k]
    if (r) {
      var name = r.firstName+' '+r.lastName
      options[k] = { NL:name,EN:name }
    }
  }
  if (!count(options)) options = { '_': {NL:'maak eerst rijder aan',EN:'define riders first'} }
  return options
}

function bikeOptions() {
  var bikes = DATA.bike
  var options = {}
  for (var k in bikes) {
    var r = bikes[k]
    var name = '"'+r.name+'" '+r.make
    options[k] = { NL:name,EN:name }
  }
  if (!count(options)) options = { '_': {NL:'maak eerst fiets aan',EN:'define bikes first'} }
  return options
}

function durationOptions() {
  return {
    '3':{EN: '3 hours', NL: '3 uur'},
    '6':{EN: '6 hours', NL: '6 uur'}
  }
}

function countOptions() {
  var options = {}
  for (var i=0; i<=10; i++) {
    var s = ''+i
    options[s] = {EN:s,NL:s}
  }
  return options
}

function makePreset(itemKey) {
  var ans = {
    thys222: 'Thys 222',
    quest: 'Velomobiel.nl Quest',
    df: 'InterCityBike DF'
  }
  return ans[fieldValue(itemKey,'standard')]
}

function trackPreset(itemKey) {
  var ans = {
    unfaired2: 'single',
    unfaired3: 'multi',
    tailfaired2: 'single',
    tailfaired3: 'multi',
    fullyfaired2: 'single',
    fullyfaired3: 'multi',
    quest: 'multi',
    df: 'multi',
    thys222: 'single'
  }
  return ans[fieldValue(itemKey,'standard')]
}

function fairingPreset(itemKey) {
  var ans = {
    unfaired2: 'none',
    unfaired3: 'none',
    tailfaired2: 'tail',
    tailfaired3: 'tail',
    fullyfaired2: 'full',
    fullyfaired3: 'full',
    quest: 'full',
    df: 'full'
  }
  return ans[fieldValue(itemKey,'standard')]
}

function drivePreset(itemKey) {
  var ans = {
    unfaired2: 'pedal',
    unfaired3: 'pedal',
    tailfaired2: 'pedal',
    tailfaired3: 'pedal',
    fullyfaired2: 'pedal',
    fullyfaired3: 'pedal',
    quest: 'pedal',
    df: 'pedal',
    rowing: 'pedal',
    thys222: 'rowing',
    tandem: 'pedal',
    handbike: 'hand'
  }
  return ans[fieldValue(itemKey,'standard')]
}

/* utility functions */
function setCookie(key,value) {
  document.cookie = key + "=" + value;
}
function getCookie(key) {
  var parts = decodeURIComponent(document.cookie).split(';');
  for(var i=0; i<parts.length; i++) {
    var c = parts[i].trim()
    if (c.indexOf(key+'=') == 0) {
      return c.substr(key.length+1);
    }
  }
  return "";
}
function getElem(id) { return document.getElementById(id) }
function next(h) { var n=0; for (var k in h) if (Number(k)>=n) n = Number(k)+1; return n }
function count(h) { var n=0; for (var k in h) if (h.hasOwnProperty(k)) n++; return n }

function getValue(field) {
  if (field.tagName.toLowerCase() == 'input') {
    if (field.type == 'text') return field.value
    if (field.type == 'date') return field.value
    if (field.type == 'radio') {
      var radios = document.getElementsByName(field.id);
      for (var i in radios) if (radios[i].checked) return radios[i].value
    }
  } else if (field.tagName.toLowerCase() == 'select') {
    return field.selectedIndex < 0 ? undefined : field.options[field.selectedIndex].value
  }
}

function setValue(field,value) {
  if (field.tagName.toLowerCase() == 'input') {
    if (field.type == 'text') field.value = value
    if (field.type == 'date') field.value = value
    if (field.type == 'radio') {
      var radios = document.getElementsByName(field.id);
      for (var i=0; i<radios.length; i++) {
        var r = radios[i]
        r.checked = (r.value == value ? true : false)
      }
    }
  } else if (field.tagName.toLowerCase() == 'select') {
    var options = field.options
    for (var i=0; i<options.length; i++) if (options[i].value == value) field.selectedIndex = i
  }
}

function setOptions(field,type,options) {
  if (type == 'select') {
    var val = getValue(field)
    // remove old options
    for (var k=field.options.length-1; k>=0; k--) field.remove(k)
    // add new options
    for (var k in options) {
      var o = options[k]
      var oElem = document.createElement('OPTION')
      oElem.value = k
      oElem.text = o.EN+(o.NL != o.EN ? ' / '+o.NL : '')
      if (k == val) oElem.selected = true
      field.add(oElem,null)
    }
  }
}

function fieldValue(itemKey,k) {
  return getValue(getElem(itemKey+'-'+k))
}

/* initialization of forms and values */
function initForm(itemKey) {
  var a = []
  var fields = FORMS[itemKey]
  var complex = !fields._simple_
  a.push('<table class="add">')
  a.push('<tr>')
  if (complex) {
    var itemName = LANG[itemKey]
    var nameHtml = '<span class="EN">'+itemName.EN[0]+'</span><span class="NL">'+itemName.NL[0]+'</span>'
    a.push('<td rowspan="'+(2*count(fields)+2)+'" style="padding-right:2ex"><div class="id">'+nameHtml+'<br><select id="'+itemKey+'-id" onchange="selectItem(getValue(this),\''+itemKey+'\')"><option selected value="0">0</option></select></div></td>')
  }
  a.push('<td colspan="4"><div id="'+itemKey+'-form-error" class="error"/></td></tr>')
  for (var k in fields) {
    if (k.charAt(0) == '_') continue
    var f = fields[k]
    a.push('<tr><td colspan="4"><div id="'+itemKey+'-'+k+'-error" class="error"/></td></tr>')
    a.push('<tr><td class="key"><span class="EN">'+f.name.EN+'</span><span class="NL">'+f.name.NL+'</span></td><td class="price">'+(f.price || '')+'</td><td class="colon">:</td><td class="value">')
    if (f.type == 'text') a.push('<input id="'+itemKey+'-'+k+'" type="text" value=""/>')
    if (f.type == 'date') a.push('<input id="'+itemKey+'-'+k+'" type="date" value=""/>')
    if (f.type == 'select') {
      a.push('<select id="'+itemKey+'-'+k+'"'+(complex ? 'onchange="updateForm(\''+itemKey+'\')"' : 'onchange="simpleChange(\''+itemKey+'\',\''+k+'\')"')+'>')
      var options = f.options()
      for (var n in options) {
        var o = options[n]
        var optionName = o.EN+(o.NL != o.EN ? ' / '+o.NL : '')
        a.push('<option value="'+n+'">'+optionName+'</option>')
      }
      a.push('</select>')
    }
    if (f.type == 'radio') {
      var options = f.options()
      var first = true
      for (var n in options) {
        var optionName = '<span class="EN">'+options[n].EN+'</span><span class="NL">'+options[n].NL+'</span>'
        a.push('<input '+(first ? 'id="'+itemKey+'-'+k+'" ' : '')+' name="'+itemKey+'-'+k+'" type="radio" value="'+n+'"/>'+optionName)
        first = false
      }
    }
    a.push('</td></tr>')
  }
  if (complex) {
    var editHtml = '<span class="EN">Add/edit this '+itemName.EN[0]+'</span><span class="NL">Wijzig/Voeg '+itemName.NL[0]+' toe</span>'
    var deleteHtml = '<span class="EN">Delete this '+itemName.EN[0]+'</span><span class="NL">Verwijder '+itemName.NL[0]+'</span>'
    a.push('<tr><td colspan="4"><button onclick="addItem(\''+itemKey+'\')">'+editHtml+'</button>&nbsp;<button onclick="deleteItem(\''+itemKey+'\')"/>'+deleteHtml+'</td></tr>')
  }
  a.push('</table>')
  getElem(itemKey+'-form').innerHTML = a.join('')
  if (complex) updateItems(itemKey);
  else updateValues(itemKey) 
}

/* callback functions */
function selectItem(id,itemKey) {
  var items = DATA[itemKey]
  var r = items[id]
  var fields = FORMS[itemKey]
  if (!r) { 
    r = {}; 
    for (var k in fields) { 
      if (k.charAt(0) == '_') continue
      r[k] = fields[k].default || ''
    }
  }
  var elem = getElem(''+itemKey+'-id')
  var options = elem.options
  for (var k in options) { if (options[k].value == id) elem.selectedIndex = k }
  for (var k in fields) {
    if (k.charAt(0) == '_') continue
    setValue(getElem(itemKey+'-'+k),r[k])
  }
}

function updateItems(itemKey) {
  var items = DATA[itemKey]
  var fields = FORMS[itemKey]
  var a = []
  a.push('<div class="list"><span class="EN">List of '+LANG[itemKey].EN[1]+'</span><span class="NL">Lijst met '+LANG[itemKey].NL[1]+'</span>:<table>')
  for (var id in items) {
    var r = items[id]
    if (r) {
      a.push('<tr onclick="selectItem('+id+',\''+itemKey+'\')"><td>'+id+'</td>')
      for (var k in r) {
        var f = fields[k]
        var opts = (f && f.options && f.options()) || {}
        var v = opts[r[k]]
        v = v ? '<span class="NL">'+v.NL+'</span><span class="EN">'+v.EN+'</span>' : r[k]
        a.push('<td>'+v+'</td>')
      }
      a.push('</tr>')
    }
  }
  a.push('<tr onclick="selectItem('+next(items)+',\''+itemKey+'\')"><td>...</td></tr></tr>')
  a.push('</table></div>')
  getElem(''+itemKey+'-list').innerHTML = a.join('')
  a = []
  for (var id in items) {
    a.push('<option value="'+id+'">'+id+'</option>')
  }
  id = next(items)
  a.push('<option selected value="'+id+'">'+id+'</option>')
  getElem(''+itemKey+'-id').innerHTML = a.join('')
  selectItem(id,itemKey)
}

function updateValues(itemKey) {
  var values = DATA[itemKey]
  for (var k in values) {
    var elem = getElem(''+itemKey+'-'+k)
    setValue(elem,values[k])
  }
}

/* updates form values and options */
function updateForm(itemKey) {
  var fields = FORMS[itemKey]
  for (var k in fields) {
    if (k.charAt(0) == '_') continue
    var f = fields[k]

    var val = f.preset && f.preset(itemKey)
    var elem = getElem(itemKey+'-'+k)
    if (val) {
      setValue(elem,val)
      elem.disabled = true
    } else {
      elem.disabled = false
    }

    var options = (f.type == 'select') && f.options(itemKey)
    if (options) {
      setOptions(elem,f.type,options)
    }
  }
}

function updateForms(modifiedItem) {
  var skip = true
  for (var itemKey in FORMS) {
    if (itemKey == modifiedItem) skip = false
    if (!skip) {
      updateForm(itemKey)
    }
  }
}

function toggleError(id,msg) {
  if (msg) {
    FORM_ERROR = true
    var e = getElem(''+id+'-error'); e.innerHTML = msg; e.style.display = 'block'
  } else {
    var e = getElem(''+id+'-error'); e.innerHTML = msg; e.style.display = 'none'
  }
}

function simpleChange(itemKey,k) {
  var elem = getElem(itemKey+'-'+k)
  var val = getValue(elem)
  DATA[itemKey][k] = val
  setCookie('DATA',JSON.stringify(DATA))
  summarize()
}

function addItem(itemKey) {
  FORM_ERROR = false;
  var id = getElem(''+itemKey+'-id').value.trim()
  var fields = FORMS[itemKey]
  var values = {}
  for (var k in fields) {
    if (k.charAt(0) == '_') continue
    var f = fields[k]
    var val = getValue(getElem(''+itemKey+'-'+k),f.type)
    if (f.check) {
      if ((f.default !== undefined) && val === f.default) toggleError(itemKey+'-'+k,'') 
      else val = f.check(val,itemKey,k)
    }
    values[k] = val
  }
  if (!FORM_ERROR) {
    DATA[itemKey][id] = values
    setCookie('DATA',JSON.stringify(DATA))
    updateItems(itemKey)
    updateForms(itemKey)    
    summarize()
  }
}

function deleteItem(itemKey) {
  var id = getElem(''+itemKey+'-id').value.trim()
  DATA[itemKey][id] = null
  setCookie('DATA',JSON.stringify(DATA))
  updateItems(itemKey)
  updateForms(itemKey)    
  summarize()
}

function selectLanguage(on) {
  var off = (on == 'NL' ? 'EN' : 'NL')
  var elems = document.getElementsByClassName(off)
  for (var i=0; i<elems.length; i++) elems[i].style.display='none'
  var elems = document.getElementsByClassName(on)
  for (var i=0; i<elems.length; i++) elems[i].style.display='inline'
  setCookie('LANG',JSON.stringify(on))
}

function summarize() {
  var a = []
  getElem('submit-comment').value = JSON.stringify(DATA)
  var values = DATA['camping']
  a.push('<ul>')
  for (var k in values) {
    var elem = getElem('submit-camping-'+k)
    if (elem) elem.value = values[k]
  }
  a.push('<li><span class="NL">Op vrijdag kampeer je met '+(values.adultFri || 0)+' volwassenen en '+(values.childFri || 0)+' kinderen.</span><span class="EN">On Friday, you camp with '+(values.adultFri || 0)+' adults and '+(values.childFri || 0)+' children.</span></li>')
  a.push('<li><span class="NL">Op zaterdag kampeer je met '+(values.adultSat || 0)+' volwassenen en '+(values.childSat || 0)+' kinderen.</span><span class="EN">On Saturday, you camp with '+(values.adultSat || 0)+' adults and '+(values.childSat || 0)+' children.</span></li>')
  var values = DATA['meal']
  for (var k in values) {
    var elem = getElem('submit-meal-'+k)
    if (elem) elem.value = values[k]
  }
  a.push('<li><span class="NL">Maaltijden ... wordt aan gewerkt.</span><span class="EN">Meals ... under construction.</span></li>')
  /* compute days that riders are racing */
  var races = [[],[],[]]
  for (var itemKey in FORMS) {
    var fields = FORMS[itemKey]
    if (fields._day) races[fields._day].push(itemKey)
  }

  var riderRaces = {}
  for (var d=1; d<=2; d++) {
    var rd = races[d]
    for (var i=0; i<rd.length; i++) {
      var itemKey = rd[i]
      var br = DATA[itemKey] // bike+rider
      for (var k in br) {
        if (br[k]) {        
          var r = br[k].rider
          if (!riderRaces[r]) riderRaces[r] = [[],[],[]]
          riderRaces[r][d].push(itemKey)
        }
      }
    }
  }
  for (var r in riderRaces) {
    var sat = riderRaces[r][1].length ? 'races "'+riderRaces[r][1].join('","')+'"' : 'nothing'
    var sun = riderRaces[r][2].length ? 'races "'+riderRaces[r][2].join('","')+'"' : 'nothing'
    var zat = riderRaces[r][1].length ? 'wedstrijden "'+riderRaces[r][1].join('","')+'"' : 'niets'
    var zon = riderRaces[r][2].length ? 'wedstrijden "'+riderRaces[r][2].join('","')+'"' : 'niets'
    a.push('<li><span class="EN">Rider '+r+' rides '+sat+' on Saturday and '+sun+' on Sunday.</span><span class="NL">Rijder '+r+' rijdt '+zat+' op zaterdag en '+zon+' op zondag.</span></li>')
  }  
  a.push('</ul>')

  getElem('summary').innerHTML = a.join('')
}

</script>
</head>
<body onload="initData(); for (var k in FORMS) initForm(k); initLanguage()">
<!-- start page--><div id="page">
<img src="http://www.cyclevision.nl/wp-content/uploads/2017/02/cvheader2017blauw.png"/>
<!-- start forms--><div id="forms">
<input type="button" value="ENGLISH" onclick="selectLanguage('EN')">&nbsp;<input type="button" value="NEDERLANDS" onclick="selectLanguage('NL')">
<p><span class="EN">Welcome to the <b>CycleVision registration module</b>. It allows you to
register multiple riders with multiple bikes.<br/>If you are not participating in any races, you can also use the <a href="http://www.ligfiets.net/event/3771/cycle-vision.html">simple form at Ligfiets.net</a>.
<br/>Make sure you are logged in to your <a href="https://www.ligfiets.net/user/login" "target="_blank">Ligfiets.net account</a> before you continue.
<br/>Fill out the forms below, 
click [Done] at the bottom, and you will be taken back to the Ligfiets.net
registration page where you can confirm and pay.</span><span class="NL">Welkom bij de <b>CycleVision registratie module</b>. Hiermee kun je meerdere rijders met verschillende fietsen inschrijven voor de races.<br/>Als je geen races rijdt kun je ook het <a href="http://www.ligfiets.net/event/3771/cycle-vision.html">simpele Ligfiets.net formulier</a> gebruiken.
<br/>Zorg dat je ingelogd bent op <a href="https://www.ligfiets.net/user/login" "target="_blank">Ligfiets.net</a> voordat je verder gaat.
<br/>Vul de formulieren hieronder in, druk daarna helemaal onderaan op [Gereed], en je wordt teruggeleid naar de Ligfiets.net inschrijfpagina waar je kunt bevestigen en betalen.</span>
</p>
<h2>Camping</h2>

<div id="camping-form">
</div>

<h2><span class="EN">Meals</span><span class="NL">Maaltijden</span></h2>

<div id="meal-form">
</div>

<h2><span class="EN">Races</span><span class="NL">Wedstrijden</span></h2>

<h3>Team</h3>
<span class="EN">Enter the details for all riders that you are registering, including
yourself.</span><span class="NL">Vul voor iedere rijder die je aanmeldt de gegevens in, ook voor jezelf.</span>
<div id="rider-list">
</div>
<div id="rider-form">
</div>

<h3><span class="EN">Bikes</span><span class="NL">Fietsen</span></h3>
<span class="EN">Enter the details for all bikes that you/your team will use.</span><span class="NL">Maak hier een lijst met alle fietsen die jij of je team gaat inzetten.</span>
<div id="bike-list">
</div>
<div id="bike-form">
</div>

<h3><span class="EN">Race components</span><span class="NL">Wedstrijd onderdelen</span></h3>
<span class="EN">Enter for each race which rider+bike combinations will participate. In case of a tandem, also enter the stoker+bike combination.</span><span class="NL">Vul voor elke race de deelnemende rijder+fiets combinaties in. Voeg in geval van een tandem ook de stoker+fiets combinatie toe.</span>
<h3><span class="EN">1 hour time trial (Saturday)</span><span class="NL">1 uurs tijdrit (Zaterdag)</span></h3>
<div id="onehour-list">
</div>
<div id="onehour-form">
</div>

<h3><span class="EN">Fastest lap indoor (Saturday)</span><span class="NL">Snelste ronde velodrome (Zaterdag)</span></h3>
<div id="indoor1lap-list">
</div>
<div id="indoor1lap-form">
</div>

<h3><span class="EN">Criterium for single-track bikes (Saturday)</span><span class="NL">Criterium voor tweewielers (Zaterdag)</span></h3>
<div id="singletrack-list">
</div>
<div id="singletrack-form">
</div>

<h3><span class="EN">Criterium for multi-track bikes (Saturday)</span><span class="NL">Criterium voor drie/vierwielers (Zaterdag)</span></h3>
<div id="multitrack-list">
</div>
<div id="multitrack-form">
</div>

<h3><span class="EN">Fastest lap outdoor (Sunday)</span><span class="NL">Snelste ronde buiten (Zondag)</span></h3>
<div id="outdoor1lap-list">
</div>
<div id="outdoor1lap-form">
</div>

<h3><span class="EN">Combined 3 and 6 hour race (Sunday)</span><span class="NL">Gecombineerde 3/6 uurs race (Zondag)</span></h3>
<span class="EN">Note: the 6 hour race will only proceed with 10 or more participants.</span>
<div id="threehour-list">
</div>
<div id="threehour-form">
</div>

<h2><span class="EN">Order summary</span><span class="NL">Besteloverzicht</span></h2>

Under construction / Wordt aan gewerkt
<div id="summary"></div>

<h2><span class="EN">Confirm and pay</span><span class="NL">Bevestig en betaal</span></h2>

<form action="https://www.ligfiets.net/create/event/registration?id=3771" method="post">
  <input type="hidden" id="submit-camping-adultFri" name="stuffs[stuff_630]"/>
  <input type="hidden" id="submit-camping-childFri" name="stuffs[stuff_631]"/>
  <input type="hidden" id="submit-camping-adultSat" name="stuffs[stuff_632]"/>
  <input type="hidden" id="submit-camping-childSat" name="stuffs[stuff_633]"/>
  <input type="hidden" id="submit-meal-mealPlan" name="stuffs[stuff_634]"/>
  <input type="hidden" id="submit-meal-mealFri" name="stuffs[stuff_635]"/>
  <input type="hidden" id="submit-meal-breakfastSat" name="stuffs[stuff_636]"/>
  <input type="hidden" id="submit-meal-mealSat" name="stuffs[stuff_637]"/>
  <input type="hidden" id="submit-meal-breakfastSun" name="stuffs[stuff_638]"/>
  <input type="hidden" id="submit-races-satSun" name="stuffs[stuff_639]"/>
  <input type="hidden" id="submit-races-sat" name="stuffs[stuff_640]"/>
  <input type="hidden" id="submit-races-sun" name="stuffs[stuff_641]"/>
  <input type="hidden" id="submit-comment" name="comment"/>
  <span class="EN">Make sure you are logged in to your <a href="https://www.ligfiets.net/user/login" "target="_blank">Ligfiets.net account</a> before you continue.</span><span class="NL">Zorg dat je ingelogd bent op <a href="https://www.ligfiets.net/user/login" "target="_blank">Ligfiets.net</a> voordat je verder gaat.</span>
  <p><input type="submit" id="submit" value="Go to payment / Ga naar betalen"/></p>
</form>
</p>

<!-- end forms--></div>
<!-- end page--></div>
</body></html>